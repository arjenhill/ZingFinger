{"version":3,"file":"itouch.js","sources":["../src/core/itouch.js"],"sourcesContent":["//两个手指触点间直线的距离\n//多指触点操作的时候，v.x表示手指触点之间的水平间距，v.y表示垂直间距，利用勾股定理的公式计算出手指触点之间的直线距离\n//详解：将v.x的水平间距和v.y的垂直间距用直线连接起来，就形成了一个直角三角形的两条垂直边，指触点之间的直线距离就代表直角三角形的斜边\n//那么利用勾股定理公式就可以很容易的计算出斜边的长度，也就是手指触点之间的直线距离\nconst getLen = (v) => {\n  return Math.sqrt(v.x * v.x + v.y * v.y);\n};\n\nconst dot = (v1, v2) => {\n  return v1.x * v2.x + v1.y * v2.y;\n};\n\nconst getAngle = (v1, v2) => {\n  let mr = getLen(v1) * getLen(v2);\n  if (mr === 0) return 0;\n  let r = dot(v1, v2) / mr;\n  if (r > 1) r = 1;\n  return Math.acos(r);\n};\n\n//利用cross结果的正负来判断旋转的方向,如果值大于0，表示方向是逆时针，值小于0，表示方向顺时针\nconst cross = (v1, v2) => {\n  return v1.x * v2.y - v2.x * v1.y;\n};\n\n//利用数学向量求出旋转角度\nconst getRotateAngle = (v1, v2) => {\n  let angle = getAngle(v1, v2);\n  if (cross(v1, v2) > 0) {\n    angle *= -1;\n  }\n  return (angle * 180) / Math.PI;\n};\n\nclass HandlerAdmin {\n  constructor(el) {\n    this.handlers = [];\n    this.el = el;\n  }\n\n  add(handler) {\n    this.handlers.push(handler);\n  }\n\n  del(handler) {\n    if (!handler) this.handlers = [];\n\n    for (let i = this.handlers.length; i >= 0; i--) {\n      if (this.handlers[i] === handler) {\n        this.handlers.splice(i, 1);\n      }\n    }\n  }\n\n  dispatch() {\n    for (let i = 0, len = this.handlers.length; i < len; i++) {\n      let handler = this.handlers[i];\n      if (typeof handler === \"function\") handler.apply(this.el, arguments);\n    }\n  }\n}\n\nconst wrapEl = (el) => {\n  //el是手势库作用的DOM元素，el的值可以是选择器也可以是DOM元素\n  return typeof el == \"string\" ? document.querySelector(el) : el;\n};\nconst wrapFunc = (el, handler) => {\n  const handlerAdmin = new HandlerAdmin(el);\n  handlerAdmin.add(handler);\n\n  return handlerAdmin;\n};\n\nconst isDescendant = (parent, child) => {\n  let node = child.parentNode;\n  while (node != null) {\n    if (node == parent) {\n      return true;\n    }\n    node = node.parentNode;\n  }\n  return false;\n};\n\nexport default class AlloyFinger {\n  //option是个数据对象，包含了所有的操作回调函数\n  constructor(el, option, handleEl) {\n    this.element = wrapEl(el);\n    this.handleEl = wrapEl(handleEl);\n    this.start = this.start.bind(this);\n    this.move = this.move.bind(this);\n    this.end = this.end.bind(this);\n    this.cancel = this.cancel.bind(this);\n    //监听touch事件\n    this.element.addEventListener(\"touchstart\", this.start, false);\n    this.element.addEventListener(\"touchmove\", this.move, false);\n    this.element.addEventListener(\"touchend\", this.end, false);\n    this.element.addEventListener(\"touchcancel\", this.cancel, false);\n\n    //存储两个手指触摸点的位置的间距，水平间距和垂直间距\n    this.preV = { x: null, y: null };\n    //存储多指触摸操作时，手指触点位置之间的距离\n    this.pinchStartLen = null;\n    this.zoom = 1;\n    this.isDoubleTap = false;\n\n    let noop = function () {};\n\n    //旋转操作（多指旋转操作）\n    this.rotate = wrapFunc(this.element, option.rotate || noop);\n    //旋转操作 (单指)\n    this.singleRotate = wrapFunc(this.handleEl, option.singleRotate || noop);\n    //手指触摸开始\n    this.touchStart = wrapFunc(this.element, option.touchStart || noop);\n    //多指触摸开始\n    this.multipointStart = wrapFunc(\n      this.element,\n      option.multipointStart || noop\n    );\n    //多指触摸结束\n    this.multipointEnd = wrapFunc(this.element, option.multipointEnd || noop);\n    //捏（缩放操作）\n    this.pinch = wrapFunc(this.element, option.pinch || noop);\n    //单指缩放操作\n    this.singlePinch = wrapFunc(this.handleEl, option.singlePinch || noop);\n    //手指划过操作（兼容单个手指操作，多个手指操作）\n    this.swipe = wrapFunc(this.element, option.swipe || noop);\n    //点击操作\n    this.tap = wrapFunc(this.element, option.tap || noop);\n    //双击操作\n    this.doubleTap = wrapFunc(this.element, option.doubleTap || noop);\n    //长按操作\n    this.longTap = wrapFunc(this.element, option.longTap || noop);\n    //点击操作\n    //tap操作和singleTap操作的区别在于，如果是在一定时间内只是单击一次的话，触发的操作顺序是tap->singleTap\n    //如果是在一定时间内连续多次点击的话（包括双击操作），只会执行tap操作，不会执行singleTap操作\n    //singleTap操作其实就类似于鼠标click事件，click事件作用到移动端页面的时候，会存在延时触发事件，会先触发touch事件再执行click事件\n    this.singleTap = wrapFunc(this.element, option.singleTap || noop);\n    //单个手指触摸滑动操作\n    this.pressMove = wrapFunc(this.element, option.pressMove || noop);\n    //两个手指触摸滑动操作\n    this.twoFingerPressMove = wrapFunc(\n      this.element,\n      option.twoFingerPressMove || noop\n    );\n    //触摸滑动\n    this.touchMove = wrapFunc(this.element, option.touchMove || noop);\n    //触摸结束，手指触点离开屏幕\n    this.touchEnd = wrapFunc(this.element, option.touchEnd || noop);\n    //系统原因中断手势操作\n    this.touchCancel = wrapFunc(this.element, option.touchCancel || noop);\n\n    this._cancelAllHandler = this.cancelAll.bind(this);\n\n    window.addEventListener(\"scroll\", this._cancelAllHandler);\n\n    //手指连续按下触摸操作之间的时间间隔\n    this.delta = null;\n    //手指最近一次按下触摸操作时的时间戳\n    this.last = null;\n    //手指按下触摸操作的时间戳\n    this.now = null;\n    //接收点击操作时的定时器返回的值，用于清除定时器\n    this.tapTimeout = null;\n    //接收点击操作时的定时器返回的值，用于清除定时器\n    this.singleTapTimeout = null;\n    //接收长按操作时的定时器返回的值，用于清除定时器\n    this.longTapTimeout = null;\n    this.swipeTimeout = null;\n    this.x1 = this.x2 = this.y1 = this.y2 = null;\n    //用于存储手指触摸操作时的水平坐标和垂直坐标（如果是多指触摸操作，则记录的是第一个手指触摸的位置）\n    this.preTapPosition = { x: null, y: null };\n  }\n\n  start(evt) {\n    if (!evt.touches) return;\n    this.now = Date.now();\n    //存储手指触点相对于HTML文档左边沿的的X坐标\n    this.x1 = evt.touches[0].pageX;\n    //存储手指触点相对于HTML文档上边沿的的Y坐标\n    this.y1 = evt.touches[0].pageY;\n    //计算出手指连续按下触摸操作之间的时间间隔\n    this.delta = this.now - (this.last || this.now);\n    this.touchStart.dispatch(evt, this.element);\n    if (this.preTapPosition.x !== null) {\n      //如果手指连续触摸操作之间的时间间隔小于250毫秒，且手指连续触摸操作之间的触点位置水平坐标小于30，\n      //垂直坐标小于30，那么就判定该操作为双击操作\n      this.isDoubleTap =\n        this.delta > 0 &&\n        this.delta <= 250 &&\n        Math.abs(this.preTapPosition.x - this.x1) < 30 &&\n        Math.abs(this.preTapPosition.y - this.y1) < 30;\n      if (this.isDoubleTap) clearTimeout(this.singleTapTimeout);\n    }\n    this.preTapPosition.x = this.x1;\n    this.preTapPosition.y = this.y1;\n    this.last = this.now;\n\n    //获取触摸点的数量\n    let preV = this.preV,\n      len = evt.touches.length;\n    if (len > 1) {\n      this._cancelLongTap();\n      this._cancelSingleTap();\n      //如果是多手指操作的，计算出手指触摸点的位置的间距，水平间距和垂直间距\n      let v = {\n        x: evt.touches[1].pageX - this.x1,\n        y: evt.touches[1].pageY - this.y1,\n      };\n      preV.x = v.x;\n      preV.y = v.y;\n\n      //存储手指触点间的直线距离\n      this.pinchStartLen = getLen(preV);\n      this.multipointStart.dispatch(evt, this.element);\n    }\n    //判断操作是单击还是长按，true为长按操作，false为单击操作\n    this._preventTap = false;\n    //长按时的操作，长按时间750毫秒才会执行\n    this.longTapTimeout = setTimeout(\n      function () {\n        this.longTap.dispatch(evt, this.element);\n        this._preventTap = true;\n      }.bind(this),\n      750\n    );\n  }\n\n  move(evt) {\n    if (!evt.touches) return;\n    let preV = this.preV,\n      len = evt.touches.length,\n      currentX = evt.touches[0].pageX,\n      currentY = evt.touches[0].pageY;\n    //手指滑动的时候，就可以判定当前的操作不是双击了，所以把双击操作的状态设为false\n    this.isDoubleTap = false;\n    //多个手指操作\n    if (len > 1) {\n      let sCurrentX = evt.touches[1].pageX,\n        sCurrentY = evt.touches[1].pageY;\n      let v = {\n        x: evt.touches[1].pageX - currentX,\n        y: evt.touches[1].pageY - currentY,\n      };\n      //多指操作时，且触摸点位置的间距存在，也就是preV.x或者preV.y存在的时候才能执行pinch操作，这个判断条件必须存在\n      //（因为可能存在当多个手指触摸屏幕时，那么存在多个触摸点，但是在滑动操作的同时，只保留了一个手指触摸点，其他手指移开屏幕这样的情况，这种情况就不能执行pinch操作\n      if (preV.x !== null) {\n        if (this.pinchStartLen > 0) {\n          //计算出缩放比例（当前手指触摸点的直线距离 / 上一次滑动之前的手指触摸点的直线距离）\n          // console.log(this.pinchStartLen);\n          evt.zoom = getLen(v) / this.pinchStartLen;\n          this.pinch.dispatch(evt, this.element);\n        }\n        //旋转手势操作\n        evt.angle = getRotateAngle(v, preV);\n        // console.log(v, preV);\n        this.rotate.dispatch(evt, this.element);\n      }\n      preV.x = v.x;\n      preV.y = v.y;\n\n      if (this.x2 !== null && this.sx2 !== null) {\n        evt.deltaX = (currentX - this.x2 + sCurrentX - this.sx2) / 2;\n        evt.deltaY = (currentY - this.y2 + sCurrentY - this.sy2) / 2;\n      } else {\n        evt.deltaX = 0;\n        evt.deltaY = 0;\n      }\n      this.twoFingerPressMove.dispatch(evt, this.element);\n\n      //存储在移动操作时第二个手指的X坐标位置\n      this.sx2 = sCurrentX;\n      //存储在移动操作时第二个手指的Y坐标位置\n      this.sy2 = sCurrentY;\n    } else {\n      if (this.x2 !== null) {\n        evt.deltaX = currentX - this.x2;\n        evt.deltaY = currentY - this.y2;\n\n        //move事件中添加对当前触摸点到初始触摸点的判断，\n        //如果曾经大于过某个距离(比如10),就认为是移动到某个地方又移回来，应该不再触发tap事件才对。\n        let movedX = Math.abs(this.x1 - this.x2),\n          movedY = Math.abs(this.y1 - this.y2);\n\n        if (movedX > 10 || movedY > 10) {\n          this._preventTap = true;\n        }\n      } else {\n        evt.deltaX = 0;\n        evt.deltaY = 0;\n      }\n\n      this.pressMove.dispatch(evt, this.element);\n      // 判断是否有handleElement\n      if (\n        this.handleEl &&\n        isDescendant(this.element, this.handleEl) &&\n        this.handleEl.dataset.single == \"true\" &&\n        evt.target == this.handleEl\n      ) {\n        const startV = {\n          x: this.handleEl.offsetLeft - this.handleEl.offsetWidth / 4,\n          y: this.handleEl.offsetTop - this.handleEl.offsetHeight / 4,\n        };\n        const rectV = {\n          x: currentX - startV.x,\n          y: currentY - startV.y,\n        };\n        const preV = {\n          x: rectV.x - this.x1,\n          y: rectV.y - this.y1,\n        };\n\n        this.pinchStartLen = getLen(preV);\n        evt.zoom = getLen(rectV) / this.pinchStartLen;\n        // 单指缩放\n        this.singlePinch.dispatch(evt, this.handleEl);\n\n        // 单指旋转\n        const rotateV2 = {\n          x: rectV.x - currentX,\n          y: rectV.y - currentY,\n        };\n        evt.angle = getRotateAngle(rotateV2, preV);\n\n        // startV.x = rotateV2.x;\n        // startV.y = rotateV2.y;\n        // preV.x = rotateV2.x;\n        // preV.y = rotateV2.y;\n        console.log(preV.x, rotateV2.x, Math.abs(preV.x - rotateV2.x));\n        if (Math.abs(preV.x - rotateV2.x) > 5) {\n          // this.singleRotate.dispatch(evt, this.handleEl);\n        }\n        // console.log(this.preTapPosition);\n        // this.cancelAll();\n        // this._cancelLongTap();\n        // this._cancelSingleTap();\n        // this._cancelSingleTap();\n        // this.touchCancel.dispatch(evt, this.handleEl);\n        // 是否为在handleElement上，禁止touch与屏幕滑动的冲突\n        evt.preventDefault();\n      }\n    }\n\n    this.touchMove.dispatch(evt, this.element);\n\n    this._cancelLongTap();\n    this.x2 = currentX;\n    this.y2 = currentY;\n\n    if (len > 1) {\n      evt.preventDefault();\n    }\n  }\n\n  end(evt) {\n    if (!evt.changedTouches) return;\n    //清除长按操作的定时器，取消长按操作\n    this._cancelLongTap();\n    let self = this;\n    if (evt.touches.length < 2) {\n      this.multipointEnd.dispatch(evt, this.element);\n      this.sx2 = this.sy2 = null;\n    }\n\n    //swipe\n    //水平移动间距大于30或者垂直移动间距大于30，就判定为swipe操作\n    if (\n      (this.x2 && Math.abs(this.x1 - this.x2) > 30) ||\n      (this.y2 && Math.abs(this.y1 - this.y2) > 30)\n    ) {\n      evt.direction = this._swipeDirection(this.x1, this.x2, this.y1, this.y2);\n      this.swipeTimeout = setTimeout(function () {\n        self.swipe.dispatch(evt, self.element);\n      }, 0);\n    } else {\n      this.tapTimeout = setTimeout(function () {\n        if (!self._preventTap) {\n          self.tap.dispatch(evt, self.element);\n        }\n        // trigger double tap immediately\n        // 如果是双击操作的话，就执行\n        if (self.isDoubleTap) {\n          self.doubleTap.dispatch(evt, self.element);\n          self.isDoubleTap = false;\n        }\n      }, 0);\n\n      //如果不是双击操作，就会延时250毫秒执行singleTap操作，同时也会执行tap操作，执行顺序是tap->singleTap\n      if (!self.isDoubleTap) {\n        self.singleTapTimeout = setTimeout(function () {\n          self.singleTap.dispatch(evt, self.element);\n        }, 250);\n      }\n    }\n\n    this.touchEnd.dispatch(evt, this.element);\n\n    this.preV.x = 0;\n    this.preV.y = 0;\n    this.zoom = 1;\n    this.pinchStartLen = null;\n    this.x1 = this.x2 = this.y1 = this.y2 = null;\n  }\n  cancelAll() {\n    this._preventTap = true;\n    clearTimeout(this.singleTapTimeout);\n    clearTimeout(this.tapTimeout);\n    clearTimeout(this.longTapTimeout);\n    clearTimeout(this.swipeTimeout);\n  }\n  cancel(evt) {\n    this.cancelAll();\n    this.touchCancel.dispatch(evt, this.element);\n  }\n  _cancelLongTap() {\n    clearTimeout(this.longTapTimeout);\n  }\n  _cancelSingleTap() {\n    clearTimeout(this.singleTapTimeout);\n  }\n  //判定swipe滑动的方向\n  _swipeDirection(x1, x2, y1, y2) {\n    return Math.abs(x1 - x2) >= Math.abs(y1 - y2)\n      ? x1 - x2 > 0\n        ? \"Left\"\n        : \"Right\"\n      : y1 - y2 > 0\n      ? \"Up\"\n      : \"Down\";\n  }\n\n  on(evt, handler) {\n    if (this[evt]) {\n      this[evt].add(handler);\n    }\n  }\n\n  off(evt, handler) {\n    if (this[evt]) {\n      this[evt].del(handler);\n    }\n  }\n\n  destroy() {\n    //清除所有的定时器操作\n    if (this.singleTapTimeout) clearTimeout(this.singleTapTimeout);\n    if (this.tapTimeout) clearTimeout(this.tapTimeout);\n    if (this.longTapTimeout) clearTimeout(this.longTapTimeout);\n    if (this.swipeTimeout) clearTimeout(this.swipeTimeout);\n\n    //解绑所有的监听事件\n    this.element.removeEventListener(\"touchstart\", this.start);\n    this.element.removeEventListener(\"touchmove\", this.move);\n    this.element.removeEventListener(\"touchend\", this.end);\n    this.element.removeEventListener(\"touchcancel\", this.cancel);\n\n    //取消所有的订阅\n    this.rotate.del();\n    this.touchStart.del();\n    this.multipointStart.del();\n    this.multipointEnd.del();\n    this.pinch.del();\n    this.swipe.del();\n    this.tap.del();\n    this.doubleTap.del();\n    this.longTap.del();\n    this.singleTap.del();\n    this.pressMove.del();\n    this.twoFingerPressMove.del();\n    this.touchMove.del();\n    this.touchEnd.del();\n    this.touchCancel.del();\n\n    //自空所有的数据\n    this.preV = this.pinchStartLen = this.zoom = this.isDoubleTap = this.delta = this.last = this.now = this.tapTimeout = this.singleTapTimeout = this.longTapTimeout = this.swipeTimeout = this.x1 = this.x2 = this.y1 = this.y2 = this.preTapPosition = this.rotate = this.touchStart = this.multipointStart = this.multipointEnd = this.pinch = this.swipe = this.tap = this.doubleTap = this.longTap = this.singleTap = this.pressMove = this.touchMove = this.touchEnd = this.touchCancel = this.twoFingerPressMove = null;\n\n    window.removeEventListener(\"scroll\", this._cancelAllHandler);\n    return null;\n  }\n}\n"],"names":["getLen","v","Math","sqrt","x","y","dot","v1","v2","getAngle","mr","r","acos","cross","getRotateAngle","angle","PI","HandlerAdmin","el","handlers","handler","push","i","length","splice","len","apply","arguments","wrapEl","document","querySelector","wrapFunc","handlerAdmin","add","isDescendant","parent","child","node","parentNode","AlloyFinger","option","handleEl","element","start","bind","move","end","cancel","addEventListener","preV","pinchStartLen","zoom","isDoubleTap","noop","rotate","singleRotate","touchStart","multipointStart","multipointEnd","pinch","singlePinch","swipe","tap","doubleTap","longTap","singleTap","pressMove","twoFingerPressMove","touchMove","touchEnd","touchCancel","_cancelAllHandler","cancelAll","delta","last","now","tapTimeout","singleTapTimeout","longTapTimeout","swipeTimeout","x1","x2","y1","y2","preTapPosition","evt","touches","Date","pageX","pageY","dispatch","abs","clearTimeout","_cancelLongTap","_cancelSingleTap","_preventTap","setTimeout","currentX","currentY","sCurrentX","sCurrentY","sx2","deltaX","deltaY","sy2","movedX","movedY","dataset","single","target","startV","offsetLeft","offsetWidth","offsetTop","offsetHeight","rectV","rotateV2","log","preventDefault","changedTouches","self","direction","_swipeDirection","del","removeEventListener"],"mappings":"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"}